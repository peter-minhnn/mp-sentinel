name: ArchitectAI Code Guard (OpenAI GPT-4)
on:
  pull_request:
    types: [opened, synchronize]

jobs:
  audit:
    runs-on: ubuntu-latest
    permissions:
      contents: read
      pull-requests: write
    steps:
      - name: Checkout Code
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: Setup Node & Cache
        uses: actions/setup-node@v4
        with:
          node-version: '20'
          cache: 'npm'

      - name: Install Dependencies
        run: npm ci 

      - name: Build
        run: npm run build

      - name: Run Audit with OpenAI GPT-4
        env:
          # OpenAI Configuration
          AI_PROVIDER: openai
          AI_MODEL: gpt-4o  # Best balance of speed and accuracy
          # AI_MODEL: gpt-4.1  # Best for complex coding tasks
          # AI_MODEL: gpt-4-turbo  # Alternative option
          OPENAI_API_KEY: ${{ secrets.OPENAI_API_KEY }}
          
          # Optional: Fine-tune behavior
          AI_TEMPERATURE: 0.2
          AI_MAX_TOKENS: 8192
          
          # GitHub integration
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
          TARGET_BRANCH: origin/${{ github.base_ref }}
        run: npx architect-ai --target-branch $TARGET_BRANCH

# Setup Instructions:
# 1. Get OpenAI API key: https://platform.openai.com/api-keys
# 2. Add to GitHub Secrets: Settings → Secrets → Actions → New repository secret
#    Name: OPENAI_API_KEY
#    Value: sk-...
# 3. Rename this file to: .github/workflows/audit.yml
# 4. Commit and push
